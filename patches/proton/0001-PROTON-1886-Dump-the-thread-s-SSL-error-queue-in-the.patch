From f2ae028f534d37abc6856ce21146c70635203628 Mon Sep 17 00:00:00 2001
From: Keith Wall <kwall@apache.org>
Date: Fri, 3 Aug 2018 10:29:22 +0100
Subject: [PATCH] PROTON-1886: Dump the thread's SSL error queue in the event
 that SSL_new fails.

---
 c/src/ssl/openssl.c | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

diff --git a/c/src/ssl/openssl.c b/c/src/ssl/openssl.c
index c7aef577..2d086c7c 100644
--- a/c/src/ssl/openssl.c
+++ b/c/src/ssl/openssl.c
@@ -197,7 +197,7 @@ static void ssl_log_clear_data(pn_transport_t *transport, const char *data, size
   }
 }
 
-// unrecoverable SSL failure occured, notify transport and generate error code.
+// unrecoverable SSL failure occurred, notify transport and generate error code.
 static int ssl_failed(pn_transport_t *transport)
 {
   pni_ssl_t *ssl = transport->ssl;
@@ -1235,6 +1235,7 @@ static int init_ssl_socket(pn_transport_t* transport, pni_ssl_t *ssl)
   ssl->ssl = SSL_new(ssl->domain->ctx);
   if (!ssl->ssl) {
     pn_transport_logf(transport, "SSL socket setup failure." );
+    ssl_log_flush(transport);
     return -1;
   }
 
-- 
2.15.2 (Apple Git-101.1)

